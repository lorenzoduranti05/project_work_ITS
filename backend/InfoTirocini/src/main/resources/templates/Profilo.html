<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Profilo Aggiornato</title>
	<style>
		:root {
			--color-petrolio-scuro: #0F3B5C;
			--color-arancio-chiaro: #F0B8A6;
			--color-sfondo-card: #FAFAFA;
			--color-bordo-card: #E0E0E0;
			--color-testo: #333333;
		}

		html,
		body {
			margin: 0;
			padding: 0;
			height: 100%;
			overflow-x: hidden;
			font-family: Arial, sans-serif;
		}

		body {
			background: linear-gradient(135deg, #0f3b5cd4, #F0B8A6);
			min-height: 100%;
		}

		.navbar {
			background-color: #fafafa;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 15px;
			padding: 10px;
			font-size: 1.5em;
			margin-bottom: 15px;
			position: relative;
		}

		.navbar img {
			height: 50px;
			width: auto;
		}

		.back-arrow {
			position: absolute;
			left: 20px;
			font-size: 1.8em;
			color: var(--color-petrolio-scuro);
			text-decoration: none;
			transition: transform 0.2s;
		}

		.back-arrow:hover {
			transform: scale(1.1);
			color: #F0B8A6;
		}

		.top-dashboard {
			display: flex;
			gap: 20px;
			align-items: stretch;
			justify-content: flex-start;
			flex-wrap: wrap;
			padding: 0 20px 20px 20px;
		}

		.profile-card {
			border-radius: 8px;
			padding: 40px 20px;
			background-color: var(--color-petrolio-scuro);
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
			position: sticky;
			top: 20px;
			align-self: flex-start;
			height: 100%;
			width: 300px;

		}

		.top-row {
			flex: 1;
			display: flex;
		}

		.stats-container {
			display: flex;
			flex-direction: column;
			gap: 20px;
			flex: 1;
		}

		.card {
			background-color: #fafafa;
			border-radius: 8px;
			padding: 10px;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
			text-align: center;
			position: relative;
		}

		.card.stat-card {
			cursor: pointer;
			overflow: hidden;
			max-height: 45%;
		}

		.card.stat-card h3 {
			margin: 10px;
		}

		.number {
			color: var(--color-petrolio-scuro);
			font-size: xx-large;
		}

		.number a {
			text-decoration: none;
			color: inherit;
			display: inline-block;
		}

		.stat-dropdown {
			margin-top: 10px;
			position: static;
			left: auto;
			right: auto;
			z-index: 10;
			background-color: #0F3B5C;
			border-radius: 8px;
			max-height: 0;
			overflow: hidden;
			text-align: center;
			width: 100%;
			box-sizing: border-box;
			transition: max-height 0.3s ease, padding 0.3s ease;
		}

		.card.stat-card.active .stat-dropdown {
			max-height: calc(3 * 2em + 25px);
			overflow-y: auto;
			padding: 15px 20px;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2) inset;
		}

		.stat-dropdown-item {
			text-align: left;
			margin: 0.5rem;
			color: #fafafa;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		.profile-role-container {
			text-align: center;
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 8px;
		}

		.profile-role {
			color: #fafafa;
			font-size: 1.5em;
			font-weight: bold;
		}

		.edit-profile-button {
			background: none;
			border: none;
			padding: 0;
			cursor: pointer;
			transition: transform 0.2s;
		}

		.edit-profile-button img {
			width: 24px;
			height: 24px;
		}

		.edit-profile-button:hover {
			transform: scale(1.2);
		}

		.profile-icon {
			background-color: var(--color-petrolio-scuro);
			border-radius: 50%;
			width: 100px;
			height: 100px;
			margin: 0 auto 15px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		.contact-item {
			display: flex;
			flex-direction: column;
			gap: 5px;
			font-size: 1.1em;
			color: var(--color-testo);
			text-align: left;
		}

		.contact-label {
			font-weight: bold;
			color: #fafafa;
			min-width: 120px;
			font-size: small;
		}

		.contact-item span {
			color: #FAFAFA;
			overflow-wrap: break-word;
			word-wrap: break-word;
		}

		.modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
			box-shadow: 0 5px 25px rgba(0,0,0,0.3);
        }

        .modal-close-btn {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal-close-btn:hover,
        .modal-close-btn:focus {
            color: black;
        }

		.modal-content h2 {
			color: var(--color-petrolio-scuro);
			text-align: center;
			margin-top: 0;
		}

		.form-group {
			margin-bottom: 15px;
		}

		.form-group label {
			display: block;
			color: var(--color-petrolio-scuro);
			margin-bottom: 5px;
			font-weight: bold;
		}

		.form-group input {
			width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
		}

		.form-group input:focus {
            border-color: var(--color-petrolio-scuro);
            outline: none;
        }

		.modal-button {
			width: 100%;
            padding: 12px;
            background: var(--color-petrolio-scuro);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
		}

		.modal-button:hover {
			background: #1a6b7f;
		}

		.alert {
			padding: 15px;
			margin-bottom: 20px;
			border-radius: 8px;
			font-size: 1.1em;
			text-align: center;
		}
		.alert-success {
			color: #155724;
    		background-color: #d4edda;
    		border-color: #c3e6cb;
		}
		.alert-danger {
			color: #721c24;
    		background-color: #f8d7da;
    		border-color: #f5c6cb;
		}

		@media (max-width: 800px) {
			.top-dashboard {
				flex-direction: column;
				align-items: center;
			}

			.profile-card {
				width: 90%;
				max-width: 400px;
				margin-bottom: 20px;
				height: auto;
				position: static;
			}

			.top-row {
				width: 100%;
				display: flex;
				justify-content: center;
			}

			.stats-container {
				width: 100%;
				max-width: 400px;
				display: flex;
				flex-direction: column;
				gap: 20px;
				align-items: center;
			}

			.card.stat-card {
				width: 100%;
				max-width: 350px;
			}
		}
	</style>
</head>

<body>
	<div class="navbar">
		<a th:href="@{/home}" class="back-arrow">‚Üê</a>

		<a th:href="@{/home}" class="logo-link">
			<img class="logo" th:src="@{/immagini/Logo_Con_Scritta.png}" alt="Logo InfoTirocini">
		</a>

		Profilo
	</div>

	<div style="max-width: 800px; margin: 0 auto 20px auto; padding: 0 20px;">
		<div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
		<div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
	</div>

	<div class="top-dashboard">
		<div class="profile-card">
			<div class="profile-role-container">
				<h2 class="profile-role" th:text="${utente.ruolo == 'USER' ? 'Studente' : utente.ruolo}">Studente</h2>
				<button class="edit-profile-button" title="Modifica Profilo" id="openModalBtn">
					<img th:src="@{/immagini/modifica12.png}" alt="Modifica" style="width: 24px; height: 24px;">
				</button>
			</div>
			<div class="profile-icon">
				<img th:src="@{/immagini/icona.png}" alt="Avatar"
					style="width: 100px; height: 100px; border-radius: 50%;">
			</div>
			<div class="contact-item">
				<br>
				<div>
					<span class="contact-label">Nome: </span><br>
					<span th:text="${utente.nome}">nome prova</span>
				</div>
				<br>
				<div>
					<span class="contact-label">Cognome: </span><br>
					<span th:text="${utente.cognome}">cognome prova</span>
				</div>
				<br>
				<div>
					<span class="contact-label">Email: </span><br>
					<span th:text="${utente.mail}">studente.esempio@dominio.it</span>
				</div>
				<br>
				<div>
					<span class="contact-label">Password: </span><br>
					<span>********</span>
				</div>
			</div>
		</div>

		<div class="top-row">
			<div class="stats-container">

				<div class="card stat-card active">
					<h3>Candidature Inviate</h3>
					<div class="number">
						<a th:text="${inviateCount}">0</a>
					</div>
					<div class="stat-dropdown">

						<div th:each="c : ${candidatureInviate}"
							th:if="${#strings.equalsIgnoreCase(c.stato, 'Inviata')}" class="stat-dropdown-item">
							<span th:text="${c.lavoro?.nome}"></span>
						</div>

						<div th:if="${inviateCount == 0}" class="stat-dropdown-item"
							style="text-align: center; color: #ccc;">
							Nessuna candidatura inviata.
						</div>
					</div>
				</div>

				<div class="card stat-card">
<<<<<<< Updated upstream
<<<<<<< Updated upstream
					<h3>Candidature Accettate</h3>
					<div class="number">
						<a th:text="${accettateCount}">0</a>
					</div>
					<div class="stat-dropdown">
						<div th:if="${accettateCount == 0}" class="stat-dropdown-item"
							style="text-align: center; color: #ccc;">
							Nessuna candidatura accettata.
						</div>
					</div>
				</div>

				<div class="card stat-card">
					<h3>Candidature Rifiutate</h3>
					<div class="number">
						<a th:text="${rifiutateCount}">0</a>
					</div>
					<div class="stat-dropdown">
						<div th:if="${rifiutateCount == 0}" class="stat-dropdown-item"
							style="text-align: center; color: #ccc;">
							Nessuna candidatura rifiutata.
						</div>
					</div>
=======
				    <h3>Candidature Accettate</h3>
				    <div class="number">
				        <a th:text="${accettateCount}">0</a>
				    </div>
				    <div class="stat-dropdown">
				        <div th:each="c : ${candidatureAccettate}"
				             th:if="${#strings.equalsIgnoreCase(c.stato, 'Accettata')}" class="stat-dropdown-item">
				            <span th:text="${c.lavoro?.nome}">Nome Lavoro Accettato</span>
				        </div>

				        <div th:if="${accettateCount == 0}" class="stat-dropdown-item"
				             style="text-align: center; color: #ccc;">
				            Nessuna candidatura accettata.
				        </div>
				    </div>
				</div>

				<div class="card stat-card">
=======
				    <h3>Candidature Accettate</h3>
				    <div class="number">
				        <a th:text="${accettateCount}">0</a>
				    </div>
				    <div class="stat-dropdown">
				        <div th:each="c : ${candidatureAccettate}"
				             th:if="${#strings.equalsIgnoreCase(c.stato, 'Accettata')}" class="stat-dropdown-item">
				            <span th:text="${c.lavoro?.nome}">Nome Lavoro Accettato</span>
				        </div>

				        <div th:if="${accettateCount == 0}" class="stat-dropdown-item"
				             style="text-align: center; color: #ccc;">
				            Nessuna candidatura accettata.
				        </div>
				    </div>
				</div>

				<div class="card stat-card">
>>>>>>> Stashed changes
				    <h3>Candidature Rifiutate</h3>
				    <div class="number">
				        <a th:text="${rifiutateCount}">0</a>
				    </div>
				    <div class="stat-dropdown">
				        <div th:each="c : ${candidatureRifiutate}"
				             th:if="${#strings.equalsIgnoreCase(c.stato, 'Rifiutata')}" class="stat-dropdown-item">
				            <span th:text="${c.lavoro?.nome}">Nome Lavoro Rifiutato</span>
				        </div>

				        <div th:if="${rifiutateCount == 0}" class="stat-dropdown-item"
				             style="text-align: center; color: #ccc;">
				            Nessuna candidatura rifiutata.
				        </div>
				    </div>
<<<<<<< Updated upstream
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
				</div>
			</div>
		</div>
	</div>

	<div id="editProfileModal" class="modal-overlay">
		<div class="modal-content">
			<span class="modal-close-btn" id="closeModalBtn">&times;</span>
			<h2>Modifica Profilo</h2>

			<form th:action="@{/profilo/aggiorna}" th:object="${profiloDTO}" method="POST" id="editProfileForm">
				<div class="form-group">
					<label for="nome">Nome</label>
					<input id="nome" type="text" th:field="*{nome}" required>
				</div>
				<div class="form-group">
					<label for="cognome">Cognome</label>
					<input id="cognome" type="text" th:field="*{cognome}" required>
				</div>
				<div class="form-group">
					<label for="mail">Email</label>
					<input id="mail" type="email" th:field="*{mail}" required>
				</div>

				<hr style="margin: 20px 0; border: 1px solid #eee;">

				<div class="form-group">
					<label for="password">Nuova Password</label>
					<input id="password" type="password" th:field="*{password}" placeholder="Lascia vuoto per non modificare">
				</div>
				<div class="form-group">
					<label for="confermaPassword">Conferma Nuova Password</label>
					<input id="confermaPassword" type="password" th:field="*{confermaPassword}" placeholder="Ripeti la nuova password">
					<span id="passwordMatchError" style="color: red; font-size: 0.9em; display: none;">Le nuove password non coincidono.</span>
				</div>

				<hr style="margin: 20px 0; border: 1px solid #eee;">

				<div class="form-group">
					<label for="passwordAttuale">Password Attuale (Obbligatoria)</label>
					<input id="passwordAttuale" type="password" th:field="*{passwordAttuale}" required placeholder="Inserisci la tua password attuale">
				</div>

				<button type="submit" class="modal-button">Salva Modifiche</button>
			</form>
		</div>
	</div>

	<script>
		const statCards = document.querySelectorAll('.stat-card');
		statCards.forEach((card, index) => {
			if (index === 0) card.classList.add('active');
			card.addEventListener('click', () => {
				statCards.forEach(c => {if (c !== card) c.classList.remove('active')});
				card.classList.toggle('active');
			});
		});

		var modal = document.getElementById("editProfileModal");
        var openBtn = document.getElementById("openModalBtn");
        var closeBtn = document.getElementById("closeModalBtn");
		var form = document.getElementById("editProfileForm");
        var newPasswordInput = document.getElementById("password");
        var confirmPasswordInput = document.getElementById("confermaPassword");
        var passwordMatchError = document.getElementById("passwordMatchError");

        openBtn.onclick = function(event) {
			event.preventDefault();
            newPasswordInput.value = '';
            confirmPasswordInput.value = '';
            document.getElementById('passwordAttuale').value = '';
            passwordMatchError.style.display = 'none';
            modal.style.display = "flex";
        }

        closeBtn.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function validatePasswordMatch() {
            if (newPasswordInput.value !== confirmPasswordInput.value && newPasswordInput.value !== '') {
                passwordMatchError.style.display = 'block';
                return false;
            } else {
                passwordMatchError.style.display = 'none';
                return true;
            }
        }

        newPasswordInput.addEventListener('keyup', validatePasswordMatch);
        confirmPasswordInput.addEventListener('keyup', validatePasswordMatch);

        form.addEventListener('submit', function(event) {
            if (newPasswordInput.value !== '' && !validatePasswordMatch()) {
                event.preventDefault();
                alert("Le nuove password inserite non coincidono. Controlla e riprova.");
            }
        });

		document.addEventListener("DOMContentLoaded", function() {
			var errorMessage = document.querySelector(".alert-danger");
			if (errorMessage && errorMessage.textContent.trim() !== "") {
				if (!document.querySelector(".alert-success")) {
					modal.style.display = "flex";
				}
			}
		});
	</script>
</body>
</html>